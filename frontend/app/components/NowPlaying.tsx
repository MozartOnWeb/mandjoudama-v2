"use client"; // This makes it a Client Component

import { useEffect, useState } from "react";
import { supabase } from "@/lib/supabase";

type NowPlayingData = {
  id: string;
  title: string;
  artist: string;
  artwork: string;
};

export default function NowPlaying() {
  const [data, setData] = useState<NowPlayingData>();
  const [error, setError] = useState<any>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchData = async () => {
      const { data, error } = await supabase
        .from("now_playing")
        .select("*")
        .eq("id", "now_playing")
        .single();

      setLoading(false);

      if (error) setError(error);
      else setData(data);
    };

    fetchData();
  }, []);

  return (
    <div className="section section_2">
      <div className="title">
        <h3>Listening now</h3>
        <div className="middle_dot"></div>
        <h3>Apple Music</h3>
      </div>

      {/* <svg
        width="879"
        height="762"
        viewBox="0 0 879 762"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          fill-rule="evenodd"
          clip-rule="evenodd"
          d="M878.064 366.898C877.366 365.045 875.255 359.403 775.473 364.085C743.275 365.59 684.243 369.134 605.532 377.152C734.023 339.444 816.877 258.407 835.518 205.519C841.89 187.436 840.401 173.182 831.327 165.382C816.577 152.7 783.558 158.842 738.355 182.682C711.409 196.891 680.281 217.313 645.934 243.209C680.05 211.824 709.167 184.745 732.281 162.9C790.963 107.426 790.975 105.101 790.989 102.157C790.997 100.782 790.301 99.5377 789.296 99.1323C787.669 98.463 784.292 97.0331 696.887 176.675C671.161 200.121 626.9 241.004 574.026 292.113C641.429 207.349 671.9 133.557 667.11 105.057C665.77 97.0754 661.556 92.8396 655.251 93.124C627.486 94.3781 577.881 171.075 531.74 262.539C573.55 134.814 561.184 45.6457 526.717 12.8671C508.878 -4.09501 486.18 -3.52719 467.491 14.35C437.616 42.9213 416.68 114.126 433.231 233.706C413.058 164.419 390.388 98.9253 377.128 100.434C374.665 100.688 372.51 102.721 371.13 105.936C360.834 129.971 385.96 264.248 437.071 351.701C363.381 302.294 249.945 342.365 202.569 378.202C188.33 388.973 186.158 397.808 186.845 403.318C189.465 424.411 248.555 410.039 303.041 419.223C302.079 419.451 301.129 419.68 300.173 419.91C119.177 463.519 23.4758 550.637 4.35699 603.007C-2.60306 622.075 -0.606354 638.036 9.9836 647.955C29.2415 665.991 74.3879 661.912 133.833 636.771C179.573 617.428 232.996 586.187 291.613 544.686C212.497 613.636 129.687 690.804 130.254 711.281C130.338 714.369 131.942 716.479 134.659 717.074C157.754 722.128 238.479 714.062 344.577 585.995C277.091 704.879 318.805 723.919 330.837 753.927C333.899 761.568 338.787 761.839 341.8 761.113C342.021 761.06 342.233 761.002 342.429 760.94C349.815 758.667 373.207 740.556 414.604 614.689C399.838 679.984 391.094 731.628 398.675 737.571C400.429 738.951 402.783 738.576 405.142 736.577C423.018 721.399 479.484 661.901 486.805 551.727C507.063 650.712 561.732 670.963 581.73 673.617C585.631 674.126 587.805 671.231 588.557 669.966C597.126 655.626 571.329 591.149 539.164 522.372C568.765 562.489 602.132 591 637.686 606.201C680.794 624.622 726.866 622.812 764.089 601.211C800.124 580.306 821.75 544.903 820.529 508.82C819.354 474.107 796.771 443.498 756.945 422.625C728.932 407.945 693.36 398.067 650.606 393.04C708.248 390.264 757.487 387.243 795.867 384.113C873.743 377.76 876.028 373.822 877.542 371.221C878.345 369.838 878.542 368.183 878.064 366.898Z"
          fill="#fdfdf1"
        />
      </svg> */}

      <svg
        width="879"
        height="762"
        viewBox="0 0 879 762"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          fillRule="evenodd"
          clipRule="evenodd"
          d="M0.49983 394.715C1.19748 396.568 3.30829 402.21 103.09 397.528C135.288 396.023 194.32 392.479 273.031 384.461C144.54 422.169 61.686 503.206 43.0452 556.094C36.673 574.177 38.1621 588.431 47.2366 596.231C61.9861 608.912 95.0053 602.771 140.209 578.931C167.155 564.722 198.282 544.3 232.629 518.404C198.514 549.789 169.396 576.867 146.283 598.713C87.6008 654.187 87.588 656.512 87.5739 659.456C87.5664 660.831 88.2621 662.075 89.2669 662.481C90.8946 663.15 94.2715 664.58 181.676 584.938C207.402 561.492 251.663 520.609 304.538 469.5C237.134 554.264 206.663 628.056 211.454 656.556C212.793 664.537 217.007 668.773 223.312 668.489C251.077 667.235 300.683 590.538 346.823 499.074C305.013 626.798 317.379 715.967 351.846 748.746C369.686 765.708 392.384 765.14 411.073 747.263C440.948 718.692 461.884 647.487 445.332 527.907C465.505 597.194 488.176 662.688 501.435 661.179C503.899 660.925 506.053 658.892 507.433 655.676C517.729 631.642 492.603 497.365 441.493 409.912C515.183 459.319 628.618 419.248 675.995 383.411C690.233 372.64 692.405 363.805 691.718 358.295C689.099 337.202 630.008 351.574 575.522 342.39C576.484 342.162 577.434 341.933 578.39 341.703C759.386 298.094 855.088 210.976 874.206 158.606C881.166 139.538 879.17 123.577 868.58 113.657C849.322 95.6217 804.175 99.7009 744.73 124.842C698.991 144.185 645.567 175.426 586.95 216.926C666.066 147.977 748.876 70.8087 748.31 50.3323C748.225 47.2435 746.621 45.1341 743.904 44.539C720.809 39.4845 640.084 47.5512 533.987 175.618C601.472 56.7339 559.759 37.6942 547.726 7.68639C544.665 0.0448377 539.776 -0.226538 536.763 0.499464C536.542 0.552679 536.331 0.611148 536.135 0.673383C528.749 2.94609 505.357 21.0568 463.959 146.924C478.725 81.6293 487.47 29.9851 479.889 24.0423C478.134 22.6619 475.78 23.0372 473.421 25.0359C455.545 40.2139 399.079 99.7124 391.758 209.886C371.5 110.901 316.831 90.6498 296.834 87.9959C292.933 87.4866 290.758 90.382 290.006 91.6472C281.437 105.987 307.234 170.464 339.4 239.241C309.799 199.124 276.431 170.613 240.877 155.412C197.769 136.991 151.697 138.801 114.474 160.402C78.4391 181.307 56.8137 216.71 58.0348 252.793C59.2098 287.506 81.7927 318.115 121.618 338.987C149.631 353.668 185.203 363.546 227.957 368.573C170.316 371.349 121.077 374.37 82.6963 377.5C4.82041 383.853 2.53531 387.791 1.02166 390.392C0.218206 391.775 0.0217051 393.43 0.49983 394.715Z"
          fill="#fdfdf1"
        />
      </svg>

      {!loading ? (
        <div className="now_playing_footer">
          <img
            src={data?.artwork ? data?.artwork : ""}
            alt={`${data?.title} by ${data?.artist}`}
          />
          <div>
            <p>{data?.title}</p>
            <p>{data?.artist}</p>
          </div>
        </div>
      ) : (
        <div className="now_playing_footer">
          <img
            src={
              "https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Apple_Music_icon.svg/2048px-Apple_Music_icon.svg.png"
            }
            alt={`loading`}
          />
          <div>
            <p>Loading...</p>
            <p>Loading...</p>
          </div>
        </div>
      )}
    </div>
  );
}
